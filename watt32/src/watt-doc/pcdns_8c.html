<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Watt-32 tcp/ip: /home/fosco/src/SSH2DOS/watt32/src/pcdns.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Watt-32 tcp/ip
   &#160;<span id="projectnumber">2.2 dev-rel.10</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('pcdns_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">pcdns.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="pcdns_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9594c34062cf18f57426f4dbb2f619de"><td class="memItemLeft" align="right" valign="top"><a id="a9594c34062cf18f57426f4dbb2f619de"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>int</b> (W32_CALL *_resolve_hook)(<a class="el" href="tcp_8h.html#ac1f7eba6bc7e9c6de5782062335462e6">void</a>) = NULL</td></tr>
<tr class="separator:a9594c34062cf18f57426f4dbb2f619de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37d8127c3f5393e2ed4499dfa2c95eea"><td class="memItemLeft" align="right" valign="top"><a id="a37d8127c3f5393e2ed4499dfa2c95eea"></a>
static <a class="el" href="tcp_8h.html#ac1f7eba6bc7e9c6de5782062335462e6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcdns_8c.html#a37d8127c3f5393e2ed4499dfa2c95eea">query_init</a> (struct <a class="el" href="struct_d_n_s__query.html">DNS_query</a> *q, BOOL is_ip6)</td></tr>
<tr class="memdesc:a37d8127c3f5393e2ed4499dfa2c95eea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise the query header and clear the alternate addr-list. <br /></td></tr>
<tr class="separator:a37d8127c3f5393e2ed4499dfa2c95eea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f8e60c9f6d3a232417e0f0b2ae072b9"><td class="memItemLeft" align="right" valign="top"><a id="a7f8e60c9f6d3a232417e0f0b2ae072b9"></a>
static <a class="el" href="tcp_8h.html#ac1f7eba6bc7e9c6de5782062335462e6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcdns_8c.html#a7f8e60c9f6d3a232417e0f0b2ae072b9">store_alt_address</a> (const <a class="el" href="tcp_8h.html#ac1f7eba6bc7e9c6de5782062335462e6">void</a> *data, int idx, BOOL is_ip6)</td></tr>
<tr class="memdesc:a7f8e60c9f6d3a232417e0f0b2ae072b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remember alternate address in dom_a?list[]. <br /></td></tr>
<tr class="separator:a7f8e60c9f6d3a232417e0f0b2ae072b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae91efd764a2f519430d502a99de4538d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcdns_8c.html#ae91efd764a2f519430d502a99de4538d">pack_domain</a> (BYTE *dst, const char *src)</td></tr>
<tr class="memdesc:ae91efd764a2f519430d502a99de4538d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pack a regular text string into a packed domain name, suitable for the name server.  <a href="#ae91efd764a2f519430d502a99de4538d">More...</a><br /></td></tr>
<tr class="separator:ae91efd764a2f519430d502a99de4538d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13a43a32e54f32523c0e0ed4ca936586"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcdns_8c.html#a13a43a32e54f32523c0e0ed4ca936586">send_query</a> (<a class="el" href="unionsock__type.html">sock_type</a> *sock, struct <a class="el" href="struct_d_n_s__query.html">DNS_query</a> *q, const char *name, DWORD towho, WORD qtype)</td></tr>
<tr class="memdesc:a13a43a32e54f32523c0e0ed4ca936586"><td class="mdescLeft">&#160;</td><td class="mdescRight">Put together a domain lookup packet and send it.  <a href="#a13a43a32e54f32523c0e0ed4ca936586">More...</a><br /></td></tr>
<tr class="separator:a13a43a32e54f32523c0e0ed4ca936586"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff02570928fa58300a12a1d57bc03496"><td class="memItemLeft" align="right" valign="top"><a id="aff02570928fa58300a12a1d57bc03496"></a>
static __inline int&#160;</td><td class="memItemRight" valign="bottom"><b>count_paths</b> (const char *path_str)</td></tr>
<tr class="separator:aff02570928fa58300a12a1d57bc03496"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa02397858d9c41fc87fed63381f925f"><td class="memItemLeft" align="right" valign="top"><a id="afa02397858d9c41fc87fed63381f925f"></a>
static __inline const char *&#160;</td><td class="memItemRight" valign="bottom"><b>get_path</b> (const char *path_str, int which_one)</td></tr>
<tr class="separator:afa02397858d9c41fc87fed63381f925f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8a1976ab13d92243d41b436029fc70d"><td class="memItemLeft" align="right" valign="top"><a id="ab8a1976ab13d92243d41b436029fc70d"></a>
static <a class="el" href="tcp_8h.html#ac1f7eba6bc7e9c6de5782062335462e6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcdns_8c.html#ab8a1976ab13d92243d41b436029fc70d">extract_cname</a> (const struct <a class="el" href="struct_d_n_s__query.html">DNS_query</a> *q, const char *src, char *dest, size_t max)</td></tr>
<tr class="memdesc:ab8a1976ab13d92243d41b436029fc70d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Extract the CNAME from a resource record. <br /></td></tr>
<tr class="separator:ab8a1976ab13d92243d41b436029fc70d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53d87e70c15ab493c8b3dd72e7785c72"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcdns_8c.html#a53d87e70c15ab493c8b3dd72e7785c72">unpack_domain</a> (const struct <a class="el" href="struct_d_n_s__query.html">DNS_query</a> *q, const BYTE *src, size_t src_size, BYTE *dst, size_t dst_size)</td></tr>
<tr class="memdesc:a53d87e70c15ab493c8b3dd72e7785c72"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unpack a received compressed domain name.  <a href="#a53d87e70c15ab493c8b3dd72e7785c72">More...</a><br /></td></tr>
<tr class="separator:a53d87e70c15ab493c8b3dd72e7785c72"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72b681b54919f7453bbbc18561e42372"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcdns_8c.html#a72b681b54919f7453bbbc18561e42372">read_response</a> (const struct <a class="el" href="struct_d_n_s__query.html">DNS_query</a> *q, int len, WORD qtype, <a class="el" href="tcp_8h.html#ac1f7eba6bc7e9c6de5782062335462e6">void</a> *addr)</td></tr>
<tr class="memdesc:a72b681b54919f7453bbbc18561e42372"><td class="mdescLeft">&#160;</td><td class="mdescRight">Extract the IPv4/v6 address from a response message (A or AAAA record).  <a href="#a72b681b54919f7453bbbc18561e42372">More...</a><br /></td></tr>
<tr class="separator:a72b681b54919f7453bbbc18561e42372"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8524687c0d12aab96fe8e7ebfe537bf5"><td class="memItemLeft" align="right" valign="top"><a id="a8524687c0d12aab96fe8e7ebfe537bf5"></a>
static __inline BOOL&#160;</td><td class="memItemRight" valign="bottom"><b>legal_ident</b> (WORD id, const WORD *cache, int num)</td></tr>
<tr class="separator:a8524687c0d12aab96fe8e7ebfe537bf5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83b58cb64e6ed8090f1c565ca46bf6f2"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcdns_8c.html#a83b58cb64e6ed8090f1c565ca46bf6f2">lookup_domain</a> (struct <a class="el" href="struct_d_n_s__query.html">DNS_query</a> *q, const char *mname, BOOL add_dom, DWORD nameserver, BOOL *timedout, BOOL is_aaaa, <a class="el" href="tcp_8h.html#ac1f7eba6bc7e9c6de5782062335462e6">void</a> *addr)</td></tr>
<tr class="memdesc:a83b58cb64e6ed8090f1c565ca46bf6f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">DOMAIN based name lookup.  <a href="#a83b58cb64e6ed8090f1c565ca46bf6f2">More...</a><br /></td></tr>
<tr class="separator:a83b58cb64e6ed8090f1c565ca46bf6f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48018e917a6c0c51e22a06372a56adf4"><td class="memItemLeft" align="right" valign="top"><a id="a48018e917a6c0c51e22a06372a56adf4"></a>
static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcdns_8c.html#a48018e917a6c0c51e22a06372a56adf4">next_domain</a> (const char *domain, int count)</td></tr>
<tr class="memdesc:a48018e917a6c0c51e22a06372a56adf4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given domain and count = 0,1,2,..., return next larger domain or NULL when no more are available. <br /></td></tr>
<tr class="separator:a48018e917a6c0c51e22a06372a56adf4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8334914b04d35b14e6cfffc3555cf646"><td class="memItemLeft" align="right" valign="top"><a id="a8334914b04d35b14e6cfffc3555cf646"></a>
static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcdns_8c.html#a8334914b04d35b14e6cfffc3555cf646">server_error</a> (enum DNS_serv_resp err)</td></tr>
<tr class="memdesc:a8334914b04d35b14e6cfffc3555cf646"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return text for server-side errors. <br /></td></tr>
<tr class="separator:a8334914b04d35b14e6cfffc3555cf646"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfba3510ffd232abe2d08e363a18e17f"><td class="memItemLeft" align="right" valign="top"><a id="abfba3510ffd232abe2d08e363a18e17f"></a>
static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcdns_8c.html#abfba3510ffd232abe2d08e363a18e17f">client_error</a> (enum DNS_client_code err)</td></tr>
<tr class="memdesc:abfba3510ffd232abe2d08e363a18e17f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return text for client-side errors. <br /></td></tr>
<tr class="separator:abfba3510ffd232abe2d08e363a18e17f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39b49c95177c91c74b9feee67b30c37f"><td class="memItemLeft" align="right" valign="top"><a id="a39b49c95177c91c74b9feee67b30c37f"></a>
const char *W32_CALL&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcdns_8c.html#a39b49c95177c91c74b9feee67b30c37f">dom_strerror</a> (int err)</td></tr>
<tr class="memdesc:a39b49c95177c91c74b9feee67b30c37f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return text for error code (dom_errno). <br /></td></tr>
<tr class="separator:a39b49c95177c91c74b9feee67b30c37f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3afbd5c626e56d6f0bf837b710eebeb7"><td class="memItemLeft" align="right" valign="top"><a id="a3afbd5c626e56d6f0bf837b710eebeb7"></a>
char *W32_CALL&#160;</td><td class="memItemRight" valign="bottom"><b>dom_remove_dot</b> (char *name)</td></tr>
<tr class="separator:a3afbd5c626e56d6f0bf837b710eebeb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a989a51beafe9c88a9d0ae7f09cddecd6"><td class="memItemLeft" align="right" valign="top">DWORD W32_CALL&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcdns_8c.html#a989a51beafe9c88a9d0ae7f09cddecd6">resolve</a> (const char *name)</td></tr>
<tr class="memdesc:a989a51beafe9c88a9d0ae7f09cddecd6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert host name to an address.  <a href="#a989a51beafe9c88a9d0ae7f09cddecd6">More...</a><br /></td></tr>
<tr class="separator:a989a51beafe9c88a9d0ae7f09cddecd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa86a275b9039ee6010ebf8dd6d6e1d85"><td class="memItemLeft" align="right" valign="top"><a id="aa86a275b9039ee6010ebf8dd6d6e1d85"></a>
int W32_CALL&#160;</td><td class="memItemRight" valign="bottom"><b>resolve_ip6</b> (const char *name, <a class="el" href="tcp_8h.html#ac1f7eba6bc7e9c6de5782062335462e6">void</a> *addr)</td></tr>
<tr class="separator:aa86a275b9039ee6010ebf8dd6d6e1d85"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:afb3dcca2e459bd2e5e989a2e7ebf6d86"><td class="memItemLeft" align="right" valign="top"><a id="afb3dcca2e459bd2e5e989a2e7ebf6d86"></a>
BOOL&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcdns_8c.html#afb3dcca2e459bd2e5e989a2e7ebf6d86">called_from_resolve</a> = FALSE</td></tr>
<tr class="memdesc:afb3dcca2e459bd2e5e989a2e7ebf6d86"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hacks to make gethostbyname() and <a class="el" href="pcdns_8c.html#a989a51beafe9c88a9d0ae7f09cddecd6" title="Convert host name to an address. ">resolve()</a> cooperate. <br /></td></tr>
<tr class="separator:afb3dcca2e459bd2e5e989a2e7ebf6d86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb69edbcdf8403daae4dfc01fb2450c2"><td class="memItemLeft" align="right" valign="top"><a id="abb69edbcdf8403daae4dfc01fb2450c2"></a>
BOOL&#160;</td><td class="memItemRight" valign="bottom"><b>called_from_ghbn</b> = FALSE</td></tr>
<tr class="separator:abb69edbcdf8403daae4dfc01fb2450c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3dfdb46c69847ba8063ff5f568fd6053"><td class="memItemLeft" align="right" valign="top"><a id="a3dfdb46c69847ba8063ff5f568fd6053"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcdns_8c.html#a3dfdb46c69847ba8063ff5f568fd6053">defaultdomain</a> [MAX_HOSTLEN+1] = &quot;your.domain.com&quot;</td></tr>
<tr class="memdesc:a3dfdb46c69847ba8063ff5f568fd6053"><td class="mdescLeft">&#160;</td><td class="mdescRight">The 2 next variables are loaded from WATTCP.CFG file. <br /></td></tr>
<tr class="separator:a3dfdb46c69847ba8063ff5f568fd6053"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5be09c1125ab3b7d2e20795983c35b1d"><td class="memItemLeft" align="right" valign="top"><a id="a5be09c1125ab3b7d2e20795983c35b1d"></a>
char *&#160;</td><td class="memItemRight" valign="bottom"><b>def_domain</b> = <a class="el" href="pcdns_8c.html#a3dfdb46c69847ba8063ff5f568fd6053">defaultdomain</a></td></tr>
<tr class="separator:a5be09c1125ab3b7d2e20795983c35b1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a137d86ea288feef5addacb708981e13a"><td class="memItemLeft" align="right" valign="top"><a id="a137d86ea288feef5addacb708981e13a"></a>
BOOL&#160;</td><td class="memItemRight" valign="bottom"><b>_resolve_exit</b></td></tr>
<tr class="separator:a137d86ea288feef5addacb708981e13a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae3548c64dd78aec27091c92d5b117fd"><td class="memItemLeft" align="right" valign="top"><a id="aae3548c64dd78aec27091c92d5b117fd"></a>
BOOL&#160;</td><td class="memItemRight" valign="bottom"><b>_resolve_timeout</b></td></tr>
<tr class="separator:aae3548c64dd78aec27091c92d5b117fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42e2ad210db66aa66b85403cd84eaf1f"><td class="memItemLeft" align="right" valign="top"><a id="a42e2ad210db66aa66b85403cd84eaf1f"></a>
BOOL&#160;</td><td class="memItemRight" valign="bottom"><b>from_windns</b></td></tr>
<tr class="separator:a42e2ad210db66aa66b85403cd84eaf1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a744680b7cdd92517a8ddd57cbd0a25d6"><td class="memItemLeft" align="right" valign="top"><a id="a744680b7cdd92517a8ddd57cbd0a25d6"></a>
DWORD&#160;</td><td class="memItemRight" valign="bottom"><b>dom_ttl</b></td></tr>
<tr class="separator:a744680b7cdd92517a8ddd57cbd0a25d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5404381dcd4b4ddec4559de0c3cceef9"><td class="memItemLeft" align="right" valign="top"><a id="a5404381dcd4b4ddec4559de0c3cceef9"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>dom_errno</b></td></tr>
<tr class="separator:a5404381dcd4b4ddec4559de0c3cceef9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52070d7aa74d53c9be49b0c6531f1f32"><td class="memItemLeft" align="right" valign="top"><a id="a52070d7aa74d53c9be49b0c6531f1f32"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><b>dom_cname</b> [MAX_HOSTLEN+1]</td></tr>
<tr class="separator:a52070d7aa74d53c9be49b0c6531f1f32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a942045c514c492c9975b77a8f22ca3"><td class="memItemLeft" align="right" valign="top"><a id="a0a942045c514c492c9975b77a8f22ca3"></a>
DWORD&#160;</td><td class="memItemRight" valign="bottom"><b>def_nameservers</b> [MAX_NAMESERVERS]</td></tr>
<tr class="separator:a0a942045c514c492c9975b77a8f22ca3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bcc99478865f630ea63976db1cc4dd5"><td class="memItemLeft" align="right" valign="top"><a id="a4bcc99478865f630ea63976db1cc4dd5"></a>
WORD&#160;</td><td class="memItemRight" valign="bottom"><b>last_nameserver</b> = 0</td></tr>
<tr class="separator:a4bcc99478865f630ea63976db1cc4dd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cf725001fc380c10d81a8f8bab56715"><td class="memItemLeft" align="right" valign="top"><a id="a6cf725001fc380c10d81a8f8bab56715"></a>
WORD&#160;</td><td class="memItemRight" valign="bottom"><b>dns_timeout</b> = 0</td></tr>
<tr class="separator:a6cf725001fc380c10d81a8f8bab56715"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1eb28644ef54aecad4d5b3cd5a2c15a4"><td class="memItemLeft" align="right" valign="top"><a id="a1eb28644ef54aecad4d5b3cd5a2c15a4"></a>
BOOL&#160;</td><td class="memItemRight" valign="bottom"><b>dns_recurse</b> = TRUE</td></tr>
<tr class="separator:a1eb28644ef54aecad4d5b3cd5a2c15a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab73aec55ee3fd26dbee42e9d5929ef4"><td class="memItemLeft" align="right" valign="top"><a id="aab73aec55ee3fd26dbee42e9d5929ef4"></a>
BOOL&#160;</td><td class="memItemRight" valign="bottom"><b>dns_do_ipv6</b> = TRUE</td></tr>
<tr class="separator:aab73aec55ee3fd26dbee42e9d5929ef4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab110d02dbb8db9af8c4a4aa6fbf5e1e6"><td class="memItemLeft" align="right" valign="top"><a id="ab110d02dbb8db9af8c4a4aa6fbf5e1e6"></a>
BOOL&#160;</td><td class="memItemRight" valign="bottom"><b>dns_do_idna</b> = FALSE</td></tr>
<tr class="separator:ab110d02dbb8db9af8c4a4aa6fbf5e1e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08d09de8a9a1cf908f4973dd2d7ba68d"><td class="memItemLeft" align="right" valign="top"><a id="a08d09de8a9a1cf908f4973dd2d7ba68d"></a>
WORD&#160;</td><td class="memItemRight" valign="bottom"><b>dns_windns</b> = 0</td></tr>
<tr class="separator:a08d09de8a9a1cf908f4973dd2d7ba68d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6323f23d1c6fe8e0fdb40149deaf2d7"><td class="memItemLeft" align="right" valign="top"><a id="ac6323f23d1c6fe8e0fdb40149deaf2d7"></a>
static const char *&#160;</td><td class="memItemRight" valign="bottom"><b>loc_domain</b></td></tr>
<tr class="separator:ac6323f23d1c6fe8e0fdb40149deaf2d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76b5d070041656064fb758688472f3f3"><td class="memItemLeft" align="right" valign="top"><a id="a76b5d070041656064fb758688472f3f3"></a>
static DWORD&#160;</td><td class="memItemRight" valign="bottom"><b>res_timeout</b></td></tr>
<tr class="separator:a76b5d070041656064fb758688472f3f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a412d5140e45a4a2dca2eeefd31e03575"><td class="memItemLeft" align="right" valign="top"><a id="a412d5140e45a4a2dca2eeefd31e03575"></a>
DWORD&#160;</td><td class="memItemRight" valign="bottom"><b>dom_a4list</b> [MAX_ADDRESSES+1]</td></tr>
<tr class="separator:a412d5140e45a4a2dca2eeefd31e03575"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2303ed41e28ca7b4ec74642696638a49"><td class="memItemLeft" align="right" valign="top"><a id="a2303ed41e28ca7b4ec74642696638a49"></a>
ip6_address&#160;</td><td class="memItemRight" valign="bottom"><b>dom_a6list</b> [MAX_ADDRESSES+1]</td></tr>
<tr class="separator:a2303ed41e28ca7b4ec74642696638a49"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Domain Name Server protocol.</p>
<p>This portion of the code needs some major work. I ported it (read STOLE IT) from NCSA and lost about half the code somewhere in the process.</p>
<dl class="section version"><dt>Version</dt><dd>0.6 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Mar 19, 2004 - Added ACE encoding/decoding of international domain names. Ref. RFC-3490. </dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.5 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Aug 20, 2003 - Added storing of CNAME record (used as alias in gethostbyname, gethostbyaddr)</dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.4 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Aug 04, 2002 - Rewritten for IPv6 support (DTYPE_AAAA)</dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.3 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Jun 16, 1997 - calling usr_yield (i.e. system_yield) while resolving</dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.2 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Apr 24, 1991 - use substring portions of domain</dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Mar 18, 1991 - improved the trailing domain list</dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.0 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Feb 19, 1991 - pirated by Erick Engelke</dd></dl>
<dl class="section version"><dt>Version</dt><dd>-1.0 - NCSA code </dd></dl>

<p class="definition">Definition in file <a class="el" href="pcdns_8c_source.html">pcdns.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a83b58cb64e6ed8090f1c565ca46bf6f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83b58cb64e6ed8090f1c565ca46bf6f2">&#9670;&nbsp;</a></span>lookup_domain()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int lookup_domain </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="struct_d_n_s__query.html">DNS_query</a> *&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>mname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BOOL&#160;</td>
          <td class="paramname"><em>add_dom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DWORD&#160;</td>
          <td class="paramname"><em>nameserver</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BOOL *&#160;</td>
          <td class="paramname"><em>timedout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BOOL&#160;</td>
          <td class="paramname"><em>is_aaaa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="tcp_8h.html#ac1f7eba6bc7e9c6de5782062335462e6">void</a> *&#160;</td>
          <td class="paramname"><em>addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>DOMAIN based name lookup. </p>
<p>Query a domain name server to get an IP number Returns the machine number of the machine record for future reference. Events generated will have this number tagged with them. Returns various negative numbers on error conditions.</p>
<p>if add_dom is nonzero, add default domain. </p>

<p class="definition">Definition at line <a class="el" href="pcdns_8c_source.html#l00490">490</a> of file <a class="el" href="pcdns_8c_source.html">pcdns.c</a>.</p>

</div>
</div>
<a id="ae91efd764a2f519430d502a99de4538d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae91efd764a2f519430d502a99de4538d">&#9670;&nbsp;</a></span>pack_domain()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int pack_domain </td>
          <td>(</td>
          <td class="paramtype">BYTE *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>src</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Pack a regular text string into a packed domain name, suitable for the name server. </p>
<p>Returns length or -1 if a labellength is &gt; 63. </p>

<p class="definition">Definition at line <a class="el" href="pcdns_8c_source.html#l00148">148</a> of file <a class="el" href="pcdns_8c_source.html">pcdns.c</a>.</p>

</div>
</div>
<a id="a72b681b54919f7453bbbc18561e42372"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72b681b54919f7453bbbc18561e42372">&#9670;&nbsp;</a></span>read_response()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int read_response </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="struct_d_n_s__query.html">DNS_query</a> *&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">WORD&#160;</td>
          <td class="paramname"><em>qtype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="tcp_8h.html#ac1f7eba6bc7e9c6de5782062335462e6">void</a> *&#160;</td>
          <td class="paramname"><em>addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Extract the IPv4/v6 address from a response message (A or AAAA record). </p>
<p>Returns 0 on fail and sets appropriate status code in `dom_errno'. Returns 1 if okay and if the ip is available and copied to 'addr'. Read upto 'len' bytes from reply.</p>
<p>Note: Our query is echoed in the answer, but 'q' below is not same as we sent in <a class="el" href="pcdns_8c.html#a13a43a32e54f32523c0e0ed4ca936586" title="Put together a domain lookup packet and send it. ">send_query()</a>. </p>

<p class="definition">Definition at line <a class="el" href="pcdns_8c_source.html#l00368">368</a> of file <a class="el" href="pcdns_8c_source.html">pcdns.c</a>.</p>

</div>
</div>
<a id="a989a51beafe9c88a9d0ae7f09cddecd6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a989a51beafe9c88a9d0ae7f09cddecd6">&#9670;&nbsp;</a></span>resolve()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DWORD W32_CALL resolve </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert host name to an address. </p>
<p>Returns 0 if name is unresolvable right now. Return value is host-order. </p>

<p class="definition">Definition at line <a class="el" href="pcdns_8c_source.html#l00775">775</a> of file <a class="el" href="pcdns_8c_source.html">pcdns.c</a>.</p>

</div>
</div>
<a id="a13a43a32e54f32523c0e0ed4ca936586"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13a43a32e54f32523c0e0ed4ca936586">&#9670;&nbsp;</a></span>send_query()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int send_query </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="unionsock__type.html">sock_type</a> *&#160;</td>
          <td class="paramname"><em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="struct_d_n_s__query.html">DNS_query</a> *&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DWORD&#160;</td>
          <td class="paramname"><em>towho</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">WORD&#160;</td>
          <td class="paramname"><em>qtype</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Put together a domain lookup packet and send it. </p>
<p>Uses port DOM_DST_PORT (53). </p>

<p class="definition">Definition at line <a class="el" href="pcdns_8c_source.html#l00197">197</a> of file <a class="el" href="pcdns_8c_source.html">pcdns.c</a>.</p>

</div>
</div>
<a id="a53d87e70c15ab493c8b3dd72e7785c72"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53d87e70c15ab493c8b3dd72e7785c72">&#9670;&nbsp;</a></span>unpack_domain()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int unpack_domain </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="struct_d_n_s__query.html">DNS_query</a> *&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const BYTE *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>src_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BYTE *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>dst_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Unpack a received compressed domain name. </p>
<p>Handles pointers to continuation domain names.</p>
<ul>
<li>address of query response ('q') is used as the base for the offset of any pointer which is present.</li>
<li>returns the number of bytes at 'src' which should be skipped over. Includes the 0-terminator in its length count.</li>
<li>returns -1 if the response is munged. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="pcdns_8c_source.html#l00314">314</a> of file <a class="el" href="pcdns_8c_source.html">pcdns.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_43e0a1f539e00dcfa1a6bc4d4fee4fc2.html">home</a></li><li class="navelem"><a class="el" href="dir_ab8596c82667c0aca9997b52c5dbee43.html">fosco</a></li><li class="navelem"><a class="el" href="dir_080421ebeac7d91b01d16c10e3428daa.html">src</a></li><li class="navelem"><a class="el" href="dir_6df265bdd26cb50194bab3fa12ccd5e5.html">SSH2DOS</a></li><li class="navelem"><a class="el" href="dir_b1c9b88edcbbea5952d2cf10cb584ddc.html">watt32</a></li><li class="navelem"><a class="el" href="dir_7ffa6a371f53fb7b9b5c8573af96f924.html">src</a></li><li class="navelem"><a class="el" href="pcdns_8c.html">pcdns.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
